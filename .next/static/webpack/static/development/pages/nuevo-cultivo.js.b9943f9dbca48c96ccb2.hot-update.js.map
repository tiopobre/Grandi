{"version":3,"file":"static/webpack/static\\development\\pages\\nuevo-cultivo.js.b9943f9dbca48c96ccb2.hot-update.js","sources":["webpack:///./pages/nuevo-cultivo.jsx"],"sourcesContent":["import React, { useState, useContext } from 'react';\r\nimport Layaout from '../components/Layaout/layaout'\r\nimport Router from 'next/router'\r\nimport firebase from '../firebase';\r\n// para aÃ±adir imagenes\r\nvar uniqid = require('uniqid');\r\n//validaciones\r\nimport useValidacion from '../hooks/useValidacion'\r\nimport validarNuevoCultivo from '../validacion/validarNuevoCultivo'\r\nimport {FirebaseContext} from '../firebase' // context\r\n// State Inicial\r\nconst STATE_INICIAL = {\r\n    planta: '',\r\n    alias: '',\r\n    fechaIni: '',\r\n    descripcion: '',\r\n    img: '',\r\n    urlImg:'ll',\r\n    votos : 0,\r\n}\r\n\r\nconst nuevoCultivo = () => {\r\n    \r\n    const {valores, errores, handleChange, handleSubmit} =  useValidacion(STATE_INICIAL, validarNuevoCultivo, agregarCultivo);\r\n    const {planta, alias, fechaIni,img ,urlImg , descripcion } = valores;\r\n    // State Imagenes\r\n    const [imagen, setImagen] = useState(null);\r\n    const [urlImagen, setUrlImagen] = useState('');\r\n    // context con las crud de firebase\r\n    const {usuario, firebase} = useContext(FirebaseContext);\r\n    \r\n    // Imagenes\r\n    // asincronia for the win\r\n    //\r\n    function cambioImagen (e){\r\n        if(e.target.files[0]){\r\n            setImagen(e.target.files[0]);\r\n        }\r\n       // console.log(uniqid.process());\r\n       //crear id imagen\r\n        setUrlImagen(uniqid('cultivo'));\r\n        \r\n        console.log( 'id', urlImagen);\r\n    }\r\n\r\n    function crrear_cultivo(){\r\n        const cultivo = {\r\n            planta: planta,\r\n            alias: alias,\r\n            fechaIni: fechaIni,\r\n            descripcion: descripcion,\r\n            urlImg: urlImagen,\r\n            comentarios: [],\r\n            votos: 0,\r\n            creador: {\r\n                id : usuario.uid,\r\n                nombre: usuario.displayName\r\n            }\r\n        }\r\n        firebase.db.collection('cultivos').add(cultivo);\r\n    }\r\n    const handleURL = () =>{\r\n        console.log(\"entra handle url\");\r\n        firebase.storage\r\n        .ref(\"test_imagenes\")\r\n        .child(imagen.name)\r\n        .getDownloadURL()\r\n        .then( url =>{\r\n             console.log(\"url\", url);\r\n             setUrlImagen(url);\r\n        }\r\n        )\r\n    }\r\n\r\n    // agregar a firestore y storage\r\n    async function agregarCultivo(){\r\n            console.log('agregando cultivo...')\r\n            if(!usuario){\r\n                return Router.push('/login');\r\n            }\r\n\r\n            firebase.storage.ref('test_imagenes').child(imagen.name).put(imagen)\r\n            .then(function(){\r\n                console.log(\"se subi imagen a firebae\");\r\n            } );\r\n            \r\n            console.log(\"Usuario\", usuario.uid);\r\n            console.log(urlImagen);\r\n            // Crear cultivo\r\n            const cultivo = {\r\n                planta: planta,\r\n                alias: alias,\r\n                fechaIni: fechaIni,\r\n                descripcion: descripcion,\r\n                urlImg: urlImagen,\r\n                comentarios: [],\r\n                votos: 0,\r\n                creador: {\r\n                    id : usuario.uid,\r\n                    nombre: usuario.displayName\r\n                }\r\n            }\r\n            \r\n            //insertar en la base de datos\r\n            //firebase.storage.ref('test_imagenes').child(urlImagen).put(imagen);\r\n            //firebase.db.collection('cultivos').add(cultivo);\r\n            //return Router.push('/perfil');\r\n        }\r\n\r\n    return ( \r\n        <>\r\n            <Layaout>\r\n                <div className=\"contenedor\">\r\n                <h2  className=\"d-flex justify-content-center\">Nuevo Cultivo</h2>\r\n                <div className=\"d-flex flex-row bd-highligh justify-content-center\">\r\n                    <form \r\n                        onSubmit = {handleSubmit}\r\n                    >\r\n                      <div className=\"form-group\">\r\n                            <label >Planta</label>\r\n                            <input \r\n                                type=\"text\" \r\n                                className=\"form-control\" \r\n                                name = \"planta\"\r\n                                placeholder=\"Tipo de planta\"\r\n                                value = {planta}\r\n                                onChange ={handleChange}\r\n                            />\r\n                            {errores.planta && <p>{errores.planta}</p>}\r\n                        </div>\r\n                        <div className=\"form-group\">\r\n                            <label >Alias</label>\r\n                            <input \r\n                                type=\"text\" \r\n                                className=\"form-control\" \r\n                                name = \"alias\"\r\n                                placeholder=\"alias de tu planta\"  \r\n                                value = {alias}\r\n                                onChange ={handleChange}\r\n                            />\r\n                            <small \r\n                             \r\n                            className=\"form-text text-muted\"\r\n                            >Dale un alias a tu cultivo.</small>\r\n                        </div>\r\n\r\n                        <div className=\"form-group\">\r\n                            <label >Sube una Imagen</label>\r\n                            <input \r\n                                type = \"file\"\r\n                                \r\n                                onChange ={cambioImagen}\r\n                            />  \r\n                        </div>\r\n\r\n                        <div className=\"form-group\">\r\n                            <label >Fecha Inicial</label>\r\n                            <input \r\n                                type=\"date\" \r\n                                className=\"form-control\" \r\n                                name = \"fechaIni\"\r\n                                value = {fechaIni}\r\n                                onChange ={handleChange}\r\n                            />  \r\n                            {errores.fechaIni && <p>{errores.fechaIni}</p>}\r\n                        </div>\r\n                        <div className=\"form-group\">\r\n                            <label >Descripcion Cultivo</label>\r\n                            <input \r\n                                className=\"form-control\" \r\n                                name = \"descripcion\"\r\n                                value = {descripcion}\r\n                                onChange ={handleChange}\r\n                            />  \r\n                        </div>\r\n                        <button \r\n                            type=\"submit\" \r\n                            value= \"crear cultivo\"\r\n                            className=\"btn btn-lg btn-primary btn-block btn-signin\"\r\n                        >Agregar Cultivo</button>  \r\n                    </form> \r\n                </div>\r\n                </div>\r\n            </Layaout> \r\n        </>\r\n     );\r\n}\r\n \r\nexport default nuevoCultivo;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AACA;AASA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAWA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AAEA;AACA;AACA;AADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AARA;AAaA;AACA;AACA;AAAA;AACA;AACA;AAKA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAMA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AARA;AAeA;AACA;AACA;AACA;AAhCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAiCA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AACA;AACA;;;;A","sourceRoot":""}